
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>YumPick Admin (Secure)</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    input, textarea, button {
      display: block;
      margin: 10px 0;
      padding: 8px;
      width: 100%;
      max-width: 400px;
    }
    label { margin-top: 15px; display: block; font-weight: bold; }
    .deal-card {
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 10px;
      margin-bottom: 10px;
      max-width: 600px;
    }
    .success { color: green; }
    .error { color: red; }
    .hidden { display: none; }
  </style>
</head>
<body>

<div id="loginSection">
  <h2>🔐 Admin Login</h2>
  <input type="text" id="passwordInput" placeholder="Enter password">
  <button onclick="login()">Login</button>
  <div id="loginMsg"></div>
</div>

<div id="adminPanel" class="hidden">
  <h1>🍔 YumPick Admin Panel</h1>
  <button onclick="logout()" style="margin-bottom: 20px;">🚪 Logout</button>


  <h3>Add or Update Hot Deal</h3>
  <label>Brand</label>
  <input type="text" id="brand">
  <label>Deal</label>
  <input type="text" id="deal">
  <label>Note</label>
  <input type="text" id="note">
  <label>Link</label>
  <input type="text" id="link">
  <label>Valid Until</label>
  <input type="date" id="validUntil">
  <button onclick="saveDeal()">💾 Save</button>
  <div id="saveMsg"></div>

  <h3>📋 Current Hot Deals</h3>
  <div id="dealList">Loading...</div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyAJCZ-LH-KrMWMBck2rhNMkUAiZWy_m6wA",
    authDomain: "yumpick-6c2b6.firebaseapp.com",
    projectId: "yumpick-6c2b6",
    storageBucket: "yumpick-6c2b6.firebasestorage.app",
    messagingSenderId: "733622122733",
    appId: "1:733622122733:web:c07e67b3fa8d0c17aaf4e4"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  const PASSWORD = "Yumbless55378@"; // 🔐 설정 비밀번호

  function login() {
    const input = document.getElementById("passwordInput").value;
    if (input === PASSWORD) {
      localStorage.setItem("loggedIn", "true");
      showAdmin();
    } else {
      document.getElementById("loginMsg").innerText = "❌ Wrong password!";
    }
  }

  function showAdmin() {
    document.getElementById("loginSection").classList.add("hidden");
    document.getElementById("adminPanel").classList.remove("hidden");
    loadDeals();
  }

  function saveDeal() {
    const brand = document.getElementById("brand").value;
    const deal = document.getElementById("deal").value;
    const note = document.getElementById("note").value;
    const link = document.getElementById("link").value;
    const validUntil = document.getElementById("validUntil").value;

    if (!brand || !deal || !link || !validUntil) {
      document.getElementById("saveMsg").innerText = "⚠️ Please fill in all fields.";
      return;
    }

    const data = {
      brand, deal, note, link,
      validUntil: firebase.firestore.Timestamp.fromDate(new Date(validUntil))
    };

    db.collection("hotdeals").doc(brand).set(data).then(() => {
      document.getElementById("saveMsg").innerText = "✅ Saved!";
      loadDeals();
    });
  }

  function loadDeals() {
    const container = document.getElementById("dealList");
    container.innerHTML = "";
    db.collection("hotdeals").get().then((querySnapshot) => {
      querySnapshot.forEach((doc) => {
        const data = doc.data();
        const div = document.createElement("div");
        div.className = "deal-card";
        div.innerHTML = `
          <strong>${data.brand}</strong><br>
          🔥 Deal: ${data.deal}<br>
          📝 Note: ${data.note || '-'}<br>
          🔗 <a href="${data.link}" target="_blank">${data.link}</a><br>
          📅 Valid Until: ${data.validUntil.toDate().toISOString().split('T')[0]}<br>
          <button onclick="editDeal('${doc.id}')">✏️ Edit</button>
          <button onclick="deleteDeal('${doc.id}')">❌ Delete</button>
        `;
        container.appendChild(div);
      });
    });
  }

  function editDeal(id) {
    db.collection("hotdeals").doc(id).get().then((doc) => {
      const data = doc.data();
      document.getElementById("brand").value = data.brand;
      document.getElementById("deal").value = data.deal;
      document.getElementById("note").value = data.note;
      document.getElementById("link").value = data.link;
      const date = data.validUntil.toDate().toISOString().split('T')[0];
      document.getElementById("validUntil").value = date;
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });
  }

  function deleteDeal(id) {
    if (confirm(`Delete deal for ${id}?`)) {
      db.collection("hotdeals").doc(id).delete().then(loadDeals);
    }
  }

  
  function logout() {
    localStorage.removeItem("loggedIn");
    location.reload();
  }


  // Auto-login if previously logged in
  if (localStorage.getItem("loggedIn") === "true") {
    showAdmin();
  }
</script>

</body>
</html>
